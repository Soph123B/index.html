<html>
<head>
  <title>The Insider</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { margin: 0; overflow: hidden; background: black; }
    #game-container { 
      width: 100vw; 
      height: 100vh;
      display: none; 
    }

    /* Loading Screen Styles */
    #loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: black;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }

    .battery-container {
      width: 200px;
      height: 100px;
      position: relative;
      margin-bottom: 30px;
    }

    .battery {
      width: 180px;
      height: 80px;
      border: 5px solid #ff0000;
      border-radius: 5px;
      position: relative;
    }

    .battery::after {
      content: '';
      position: absolute;
      width: 15px;
      height: 35px;
      background: #ff0000;
      top: 50%;
      right: -20px;
      transform: translateY(-50%);
      border-radius: 0 5px 5px 0;
    }

    .battery-fill {
      width: 0%;
      height: 100%;
      background: #ff0000;
      transition: width 3s ease-in-out;
    }

    .loading-text {
      color: #ff0000;
      font-family: 'Courier New', monospace;
      font-size: 24px;
      text-align: center;
      margin-top: 20px;
    }

    .websim-credit {
      color: #ff0000;
      font-family: 'Courier New', monospace;
      font-size: 36px;
      opacity: 0;
      transition: opacity 1s ease-in-out;
      text-align: center;
      margin-top: 30px;
    }

    #start-menu {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: #ff0000;
      font-family: 'Courier New', monospace;
      z-index: 1000;
      display: none;
      text-align: center;
    }
    #start-menu h1 {
      color: #ff0000;
      font-size: 72px;
      text-shadow: 0 0 10px #ff0000;
      margin-bottom: 20px;
      text-transform: uppercase;
      letter-spacing: 5px;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { text-shadow: 0 0 10px #ff0000; }
      50% { text-shadow: 0 0 20px #ff0000, 0 0 30px #ff0000; }
      100% { text-shadow: 0 0 10px #ff0000; }
    }
    #start-button {
      padding: 15px 40px;
      font-size: 24px;
      background: transparent;
      color: #ff0000;
      border: 2px solid #ff0000;
      cursor: pointer;
      transition: all 0.3s;
      font-family: 'Courier New', monospace;
    }
    #start-button:hover {
      background: #ff0000;
      color: black;
      transform: scale(1.1);
    }
    #ui-overlay {
      position: fixed;
      top: 20px;
      right: 20px;
      color: #ff0000;
      font-family: monospace;
      font-size: 20px;
      pointer-events: none;
      text-shadow: 2px 2px 2px black;
    }
    #objectives-panel {
      position: fixed;
      left: 20px;
      top: 20px;
      background: rgba(0, 0, 0, 0.7);
      padding: 15px;
      border-radius: 5px;
      color: #ffffff;
      font-family: monospace;
      font-size: 16px;
      width: 250px;
      pointer-events: none;
    }
    .objective {
      margin: 8px 0;
      display: flex;
      align-items: center;
      transition: all 0.3s ease;
    }
    .objective.completed {
      color: #00ff00;
    }
    .objective.available {
      color: #00ff00;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { opacity: 0.7; }
      50% { opacity: 1; }
      100% { opacity: 0.7; }
    }
    .checkbox {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid #ffffff;
      border-radius: 3px;
      text-align: center;
      line-height: 18px;
      margin-right: 10px;
      color: #00ff00;
      font-weight: bold;
      font-size: 14px;
    }
    .completed .checkbox {
      background: rgba(0, 255, 0, 0.3);
      border-color: #00ff00;
    }
    .game-over {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #ff0000;
      font-family: monospace;
      font-size: 48px;
      text-align: center;
      display: none;
      text-shadow: 2px 2px 2px black;
    }
    #win-screen {
      color: #00ff00;
    }
    .restart-btn {
      padding: 10px 20px;
      font-size: 24px;
      margin-top: 20px;
      cursor: pointer;
      background: #333;
      color: white;
      border: 2px solid #666;
    }
    #instructions {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      color: #ffffff;
      font-family: monospace;
      font-size: 16px;
      text-align: center;
      text-shadow: 2px 2px 2px black;
      pointer-events: none;
    }

    /* New Robot Animation Styles */
    .robot {
      width: 120px;
      height: 160px;
      position: relative;
      margin-bottom: 30px;
    }

    .head {
      width: 60px;
      height: 60px;
      background: #ff0000;
      border-radius: 10px;
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      animation: headBob 2s infinite;
    }

    .antenna {
      width: 4px;
      height: 20px;
      background: #ff0000;
      position: absolute;
      top: -18px;
      left: 50%;
      transform: translateX(-50%);
      animation: antennaBlink 1s infinite;
    }

    .antenna::after {
      content: '';
      width: 8px;
      height: 8px;
      background: #ff0000;
      border-radius: 50%;
      position: absolute;
      top: -4px;
      left: -2px;
    }

    .eye {
      width: 15px;
      height: 15px;
      background: #000;
      border-radius: 50%;
      position: absolute;
      top: 20px;
    }

    .eye.left { left: 10px; }
    .eye.right { right: 10px; }

    .body {
      width: 80px;
      height: 80px;
      background: #ff0000;
      border-radius: 10px;
      position: absolute;
      top: 70px;
      left: 50%;
      transform: translateX(-50%);
      animation: bodyDance 2s infinite;
    }

    .arm {
      width: 20px;
      height: 60px;
      background: #ff0000;
      position: absolute;
      top: 10px;
    }

    .arm.left {
      left: -25px;
      transform-origin: top center;
      animation: leftArmDance 2s infinite;
    }

    .arm.right {
      right: -25px;
      transform-origin: top center;
      animation: rightArmDance 2s infinite;
    }

    @keyframes headBob {
      0%, 100% { transform: translateX(-50%) translateY(0); }
      50% { transform: translateX(-50%) translateY(-10px); }
    }

    @keyframes antennaBlink {
      0%, 100% { background: #ff0000; }
      50% { background: #ff6666; }
    }

    @keyframes bodyDance {
      0%, 100% { transform: translateX(-50%) rotate(0deg); }
      25% { transform: translateX(-50%) rotate(-5deg); }
      75% { transform: translateX(-50%) rotate(5deg); }
    }

    @keyframes leftArmDance {
      0%, 100% { transform: rotate(0deg); }
      50% { transform: rotate(-45deg); }
    }

    @keyframes rightArmDance {
      0%, 100% { transform: rotate(0deg); }
      50% { transform: rotate(45deg); }
    }

    .settings-panel {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.9);
      border: 2px solid #ff0000;
      padding: 20px;
      display: none;
      color: #ff0000;
      font-family: 'Courier New', monospace;
      z-index: 1100;
      width: 400px;
      max-height: 80vh;
      overflow-y: auto;
    }

    .settings-panel h2 {
      text-align: center;
      margin-top: 0;
      border-bottom: 1px solid #ff0000;
      padding-bottom: 10px;
    }

    .settings-section {
      margin: 20px 0;
      padding: 10px;
      border: 1px solid #ff0000;
      border-radius: 5px;
    }

    .settings-section h3 {
      margin-top: 0;
      color: #ff6666;
    }

    .setting-item {
      margin: 15px 0;
    }

    .setting-item label {
      display: block;
      margin-bottom: 5px;
    }

    .setting-item input[type="range"] {
      width: 100%;
      background: #ff0000;
    }

    .setting-item input[type="checkbox"] {
      margin-right: 10px;
    }

    .key-bind {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 5px 0;
    }

    .key-bind button {
      background: #330000;
      color: #ff0000;
      border: 1px solid #ff0000;
      padding: 5px 10px;
      cursor: pointer;
    }

    .key-bind button:hover {
      background: #ff0000;
      color: #000;
    }

    .graphics-preset {
      display: flex;
      gap: 10px;
      margin: 10px 0;
    }

    .graphics-preset button {
      flex: 1;
      padding: 8px;
      background: transparent;
      color: #ff0000;
      border: 1px solid #ff0000;
      cursor: pointer;
    }

    .graphics-preset button.active {
      background: #ff0000;
      color: #000;
    }

    #settings-button {
      padding: 10px 20px;
      font-size: 18px;
      background: transparent;
      color: #ff0000;
      border: 2px solid #ff0000;
      cursor: pointer;
      transition: all 0.3s;
      font-family: 'Courier New', monospace;
      margin-top: 10px;
    }

    #settings-button:hover {
      background: #ff0000;
      color: black;
    }

    #close-settings {
      display: block;
      margin: 20px auto 0;
      padding: 8px 16px;
      background: transparent;
      color: #ff0000;
      border: 1px solid #ff0000;
      cursor: pointer;
      font-family: 'Courier New', monospace;
    }

    #close-settings:hover {
      background: #ff0000;
      color: black;
    }

    #monster-select {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.95);
      z-index: 1001;
      color: #ff0000;
      font-family: 'Courier New', monospace;
    }

    .monster-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      max-width: 900px;
      margin: 40px auto;
      padding: 20px;
      max-height: 80vh;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: #ff0000 #330000;
    }

    .monster-grid::-webkit-scrollbar {
      width: 8px;
    }

    .monster-grid::-webkit-scrollbar-track {
      background: #330000;
    }

    .monster-grid::-webkit-scrollbar-thumb {
      background-color: #ff0000;
      border-radius: 4px;
    }

    .monster-card {
      background: rgba(51, 0, 0, 0.7);
      border: 2px solid #ff0000;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      overflow: hidden;
    }

    .monster-ability {
      margin: 10px 0;
      padding: 10px;
      background: rgba(255, 0, 0, 0.1);
      border-radius: 5px;
    }

    .ability-cooldown {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: #ff0000;
      padding: 10px 20px;
      border-radius: 5px;
      display: none;
    }

    .cooldown-timer {
      font-weight: bold;
    }

    .monster-preview {
      width: 200px;
      height: 200px;
      margin: 10px auto;
      position: relative;
      perspective: 1000px;
    }

    .monster-preview canvas {
      width: 100%;
      height: 100%;
    }

    .monster-name {
      font-size: 24px;
      margin: 10px 0;
      color: #ff0000;
      text-shadow: 0 0 10px #ff0000;
    }

    .monster-description {
      font-size: 14px;
      color: #ff6666;
      margin-bottom: 10px;
    }

    .monster-stats {
      display: flex;
      justify-content: space-around;
      width: 100%;
      margin-top: 10px;
    }

    .stat {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .stat-label {
      font-size: 12px;
      color: #ff9999;
    }

    .stat-value {
      font-size: 18px;
      color: #ff0000;
    }

    #back-to-menu {
      position: fixed;
      top: 20px;
      left: 20px;
      padding: 10px 20px;
      background: transparent;
      color: #ff0000;
      border: 2px solid #ff0000;
      cursor: pointer;
      font-family: 'Courier New', monospace;
    }

    #back-to-menu:hover {
      background: #ff0000;
      color: black;
    }

    .select-button {
      padding: 8px 20px;
      background: transparent;
      color: #ff0000;
      border: 1px solid #ff0000;
      margin-top: 10px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .select-button:hover {
      background: #ff0000;
      color: black;
    }
  </style>
</head>
<body>
  <div id="loading-screen">
    <div class="battery-container">
      <div class="battery">
        <div class="battery-fill"></div>
      </div>
    </div>
    <div class="loading-text">Loading...</div>
    <div class="websim-credit">Brought to you by WebSim</div>
  </div>

  <div id="start-menu">
    <div class="robot">
      <div class="head">
        <div class="antenna"></div>
        <div class="eye left"></div>
        <div class="eye right"></div>
      </div>
      <div class="body">
        <div class="arm left"></div>
        <div class="arm right"></div>
      </div>
    </div>
    <h1>The Insider</h1>
    <button id="start-button">START GAME</button>
    <div id="settings-panel" class="settings-panel">
      <h2>Settings</h2>
      
      <div class="settings-section">
        <h3>Audio</h3>
        <div class="setting-item">
          <label for="music-volume">Music Volume</label>
          <input type="range" id="music-volume" min="0" max="100" value="100">
        </div>
        <div class="setting-item">
          <label for="effects-volume">Sound Effects</label>
          <input type="range" id="effects-volume" min="0" max="100" value="100">
        </div>
      </div>

      <div class="settings-section">
        <h3>Controls</h3>
        <div class="setting-item">
          <label for="sensitivity">Mouse Sensitivity</label>
          <input type="range" id="sensitivity" min="1" max="200" value="100">
        </div>
        <div class="setting-item">
          <label>Invert Y-Axis</label>
          <input type="checkbox" id="invert-y">
        </div>
        <div class="key-binds">
          <h4>Key Bindings</h4>
          <div class="key-bind">
            <span>Forward</span>
            <button id="bind-forward">W</button>
          </div>
          <div class="key-bind">
            <span>Backward</span>
            <button id="bind-backward">S</button>
          </div>
          <div class="key-bind">
            <span>Left</span>
            <button id="bind-left">A</button>
          </div>
          <div class="key-bind">
            <span>Right</span>
            <button id="bind-right">D</button>
          </div>
        </div>
      </div>

      <div class="settings-section">
        <h3>Graphics</h3>
        <div class="graphics-preset">
          <button class="preset-btn active" data-preset="low">Low</button>
          <button class="preset-btn" data-preset="medium">Medium</button>
          <button class="preset-btn" data-preset="high">High</button>
        </div>
        <div class="setting-item">
          <label for="render-distance">Render Distance</label>
          <input type="range" id="render-distance" min="50" max="200" value="100">
        </div>
        <div class="setting-item">
          <label>Shadow Quality</label>
          <input type="checkbox" id="shadows-enabled" checked>
        </div>
        <div class="setting-item">
          <label>Fog Effects</label>
          <input type="checkbox" id="fog-enabled" checked>
        </div>
        <div class="setting-item">
          <label>Particle Effects</label>
          <input type="checkbox" id="particles-enabled" checked>
        </div>
      </div>

      <div class="settings-section">
        <h3>Display</h3>
        <div class="setting-item">
          <label>Show FPS</label>
          <input type="checkbox" id="show-fps">
        </div>
        <div class="setting-item">
          <button id="toggle-fullscreen">Toggle Fullscreen</button>
        </div>
      </div>

      <button id="close-settings">Close</button>
    </div>
    <button id="settings-button">Settings</button>
  </div>

  <div id="monster-select">
    <button id="back-to-menu">Back to Menu</button>
    <h2 style="text-align: center; margin-top: 20px;">Select Your Pursuer</h2>
    <div class="monster-grid">
      <!-- Monster cards will be added here dynamically -->
    </div>
  </div>

  <audio id="background-music" loop>
    <source src="dark-horror-background-252905.mp3" type="audio/mp3">
  </audio>

  <div id="game-container"></div>
  <div id="ui-overlay">Distance to Exit: <span id="exit-distance">0</span>m</div>
  
  <div id="objectives-panel">
    <h3 style="margin-top: 0;">Objectives:</h3>
    <div id="objectives-list">
      <div class="objective" id="obj-find-key">
        <span class="checkbox"></span>
        <span>Find the key (Gold)</span>
      </div>
      <div class="objective" id="obj-collect-evidence">
        <span class="checkbox"></span>
        <span>Collect evidence (3/3)</span>
      </div>
      <div class="objective" id="obj-reach-exit">
        <span class="checkbox"></span>
        <span>Reach the exit door</span>
      </div>
    </div>
  </div>

  <div id="instructions">
    Click to start | WASD or Arrow Keys to move | Mouse to look around | Find items to escape!
  </div>
  
  <div id="game-over" class="game-over">
    YOU DIED
    <br>
    <button class="restart-btn" onclick="location.reload()">Try Again</button>
  </div>
  <div id="win-screen" class="game-over">
    YOU ESCAPED!
    <br>
    <button class="restart-btn" onclick="location.reload()">Play Again</button>
  </div>
  
  <div class="ability-cooldown">
    Ability Cooldown: <span class="cooldown-timer">120</span>s
  </div>
  
  <script>
    // Loading screen logic
    window.addEventListener('DOMContentLoaded', () => {
      const loadingScreen = document.getElementById('loading-screen');
      const startMenu = document.getElementById('start-menu');
      const batteryFill = document.querySelector('.battery-fill');
      const websimCredit = document.querySelector('.websim-credit');
      const loadingText = document.querySelector('.loading-text');

      // Hide start menu initially
      startMenu.style.display = 'none';

      // Start the loading animation
      setTimeout(() => {
        batteryFill.style.width = '100%';
        loadingText.textContent = 'Loading... 0%';

        // Update loading percentage text
        let progress = 0;
        const progressInterval = setInterval(() => {
          progress += 1;
          loadingText.textContent = `Loading... ${progress}%`;
          
          if (progress === 100) {
            clearInterval(progressInterval);
            websimCredit.style.opacity = '1';
            
            // Show start menu and hide loading screen after delay
            setTimeout(() => {
              loadingScreen.style.display = 'none';
              startMenu.style.display = 'flex';
            }, 2000);
          }
        }, 30);
      }, 500);
    });
  </script>

  <script>
    // Settings panel functionality
    const settingsButton = document.getElementById('settings-button');
    const settingsPanel = document.getElementById('settings-panel');
    const closeSettings = document.getElementById('close-settings');
    const musicVolume = document.getElementById('music-volume');
    const sensitivity = document.getElementById('sensitivity');
    const showFps = document.getElementById('show-fps');
    const backgroundMusic = document.getElementById('background-music');

    // New settings elements
    const invertY = document.getElementById('invert-y');
    const renderDistance = document.getElementById('render-distance');
    const shadowsEnabled = document.getElementById('shadows-enabled');
    const fogEnabled = document.getElementById('fog-enabled');
    const particlesEnabled = document.getElementById('particles-enabled');
    const graphicsPresets = document.querySelectorAll('.preset-btn');
    const toggleFullscreen = document.getElementById('toggle-fullscreen');

    // Key binding functionality
    const keyBindButtons = document.querySelectorAll('[id^="bind-"]');
    let activeBindButton = null;

    keyBindButtons.forEach(button => {
      button.addEventListener('click', (e) => {
        if (activeBindButton) {
          activeBindButton.style.background = '';
        }
        activeBindButton = e.target;
        activeBindButton.style.background = '#800000';
        activeBindButton.textContent = 'Press any key...';
      });
    });

    document.addEventListener('keydown', (e) => {
      if (activeBindButton) {
        e.preventDefault();
        activeBindButton.textContent = e.code;
        activeBindButton.style.background = '';
        activeBindButton = null;
      }
    });

    // Graphics presets
    graphicsPresets.forEach(button => {
      button.addEventListener('click', () => {
        graphicsPresets.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        
        const preset = button.dataset.preset;
        switch(preset) {
          case 'low':
            shadowsEnabled.checked = false;
            fogEnabled.checked = false;
            particlesEnabled.checked = false;
            renderDistance.value = 50;
            break;
          case 'medium':
            shadowsEnabled.checked = true;
            fogEnabled.checked = true;
            particlesEnabled.checked = false;
            renderDistance.value = 100;
            break;
          case 'high':
            shadowsEnabled.checked = true;
            fogEnabled.checked = true;
            particlesEnabled.checked = true;
            renderDistance.value = 200;
            break;
        }
        updateGraphicsSettings();
      });
    });

    // Fullscreen functionality
    toggleFullscreen.addEventListener('click', () => {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch(err => {
          console.log(`Error attempting to enable fullscreen: ${err.message}`);
        });
      } else {
        document.exitFullscreen();
      }
    });

    // Graphics settings update
    function updateGraphicsSettings() {
      if (window.renderer) {
        renderer.shadowMap.enabled = shadowsEnabled.checked;
        scene.fog = fogEnabled.checked ? new THREE.FogExp2(0x000000, 0.05) : null;
        camera.far = parseInt(renderDistance.value) * 5;
        camera.updateProjectionMatrix();
      }
    }

    // Add event listeners for graphics settings
    shadowsEnabled.addEventListener('change', updateGraphicsSettings);
    fogEnabled.addEventListener('change', updateGraphicsSettings);
    renderDistance.addEventListener('input', updateGraphicsSettings);
    particlesEnabled.addEventListener('change', () => {
      if (monster && monster.userData.particles) {
        monster.userData.particles.forEach(particle => {
          particle.mesh.visible = particlesEnabled.checked;
        });
      }
    });

    settingsButton.addEventListener('click', () => {
      settingsPanel.style.display = 'block';
    });

    closeSettings.addEventListener('click', () => {
      settingsPanel.style.display = 'none';
    });

    musicVolume.addEventListener('input', (e) => {
      backgroundMusic.volume = e.target.value / 100;
    });

    sensitivity.addEventListener('input', (e) => {
      if (window.controls) {
        controls.mouseSensitivity = e.target.value / 100;
      }
    });

    let fpsDisplay;
    showFps.addEventListener('change', (e) => {
      if (e.target.checked) {
        fpsDisplay = document.createElement('div');
        fpsDisplay.style.position = 'fixed';
        fpsDisplay.style.top = '10px';
        fpsDisplay.style.left = '10px';
        fpsDisplay.style.color = '#ff0000';
        fpsDisplay.style.fontFamily = 'monospace';
        document.body.appendChild(fpsDisplay);
        
        let lastTime = performance.now();
        let frames = 0;
        
        function updateFps() {
          frames++;
          const time = performance.now();
          if (time >= lastTime + 1000) {
            fpsDisplay.textContent = `FPS: ${frames}`;
            frames = 0;
            lastTime = time;
          }
          requestAnimationFrame(updateFps);
        }
        updateFps();
      } else if (fpsDisplay) {
        fpsDisplay.remove();
        fpsDisplay = null;
      }
    });
  </script>

  <script>
    // Update the start button click handler
    document.getElementById('start-button').addEventListener('click', () => {
      document.getElementById('start-menu').style.display = 'none';
      document.getElementById('monster-select').style.display = 'block';
    });

    document.getElementById('back-to-menu').addEventListener('click', () => {
      document.getElementById('monster-select').style.display = 'none';
      document.getElementById('start-menu').style.display = 'flex';
    });
  </script>

  <script type="module" src="game.js"></script>
</body>
</html>